{% extends 'EntregaDNI/base.html' %}
{% load staticfiles %}

{% block 'TituloContenido' %}Registrar caja de DNI's{% endblock %}
{% block 'Contenido' %}
<div class="row">
  <div class="col-sm-4">
    <div class="card card-outline card-orange">
      <div class="card-body">
	<div class="img-fluid" id="escaner"></div>
      </div>
    </div>
  </div>
  <div class="col-sm-8">
    <div class="card card-outline card-orange">
      <div class="card-header">
        <h3 class="card-title">Registro de caja</h3>
      </div>
      <div class="card-body">
	<form id="FormCaja" action="" enctype="multipart/data-form" method="POST">
	  {% csrf_token %}
	  <div class="form-group">
	    <div class="input-group">
	      {{ form.codigo }}
	      <div class="input-group-append">
	        <button type="button" class="input-group-text" onclick="editarCodigo()"><i class="fas fa-edit"></i></button>
	      </div>
	    </div>
	      {% if form.errors.codigo %}<span class="text-sm text-danger">{{ form.errors.codigo }}</span>{% endif %}
	  </div>
	  <div class="form-group">
	    {{ form.centro }}
	  </div>
	  <div class="form-group">
	    {{ form.cantidad }}
	  </div>
	</form>
      </div>
      <div class="card-footer"><button class="btn btn-success btn-block" type="submit" form="FormCaja">Registrar</button></div>
    </div>
  </div>
</div>
<script src="{% static 'plugins/html5-qrcode/html5-qrcode.min.js' %}"></script>
<script>
  // Editar cÃ³digo
  const editarCodigo = () => $('#id_codigo').removeAttr('readonly');
  // Funciones de proceso de QR
  const scanSuccess = (qrmessage) => $('#id_codigo').val(qrmessage);
  const scanFailure = (error) => console.log(error);

  let escaner = new Html5QrcodeScanner("escaner", {fps:30, qrbox:250}, false);
  escaner.render(scanSuccess, scanFailure);
</script>
{% endblock %}
